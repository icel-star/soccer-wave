{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Soccer Wave - Latest Products</title>
<meta name="description" content="Discover the latest soccer products and gear at Soccer Wave. Find jerseys, shoes, balls, and accessories from top brands.">
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}

<div class="bg-gradient-to-br from-white to-pink-100 min-h-screen pt-16">
  <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-6">
    
    <!-- Hero Section -->
    <div class="text-center mb-8">
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-3 bg-gradient-to-r from-pink-400 to-pink-500 bg-clip-text text-transparent">
        Hop on the Soccer Wave!
      </h1>
      <p class="text-lg sm:text-xl text-gray-700 max-w-3xl mx-auto px-2">
        Explore our collection of premium soccer gear, from professional jerseys to cutting-edge accessories
      </p>
    </div>

    <!-- Action Bar -->
    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-3 mb-6">
      <div class="flex-1">
        <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-1">Latest Products</h2>
        <p class="text-gray-600 text-sm sm:text-base">Stay updated with the newest soccer gear</p>
      </div>
      
      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 w-full sm:w-auto">
        <!-- Filter Buttons -->
        <div class="flex bg-white rounded-lg p-1 shadow-sm border border-gray-200">
          <a href="?" class="{% if request.GET.filter == 'all' or not request.GET.filter %}bg-pink-400 text-white{% else %}text-gray-700 hover:text-pink-500{% endif %} px-4 py-2 rounded-md font-medium transition-all duration-200 text-sm">
            All Products
          </a>
          <a href="?filter=my" class="{% if request.GET.filter == 'my' %}bg-pink-400 text-white{% else %}text-gray-700 hover:text-pink-500{% endif %} px-4 py-2 rounded-md font-medium transition-all duration-200 text-sm">
            My Products
          </a>
        </div>

        <!-- Action Buttons - Desktop -->
        <div class="hidden sm:flex gap-2">
          <button id="refreshButton" class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg font-medium transition-all duration-200 hover:bg-pink-50 hover:border-pink-300 hover:text-pink-400 flex items-center shadow-sm">
            <i class="fas fa-sync-alt mr-2"></i>
            Refresh
          </button>
          <button onclick="showCreateModal()" class="bg-pink-400 text-white px-4 py-2 rounded-lg font-medium hover:bg-pink-500 transition-all duration-200 flex items-center shadow-lg">
            <i class="fas fa-plus mr-2"></i>
            Create Product by AJAX
          </button>
        </div>
      </div>
    </div>

    <!-- Product Container -->
    <div id="product-container" class="space-y-4">
      <!-- Loading State -->
      <div id="loadingState" class="bg-white rounded-xl border border-gray-200 p-8 sm:p-12 text-center shadow-lg">
        <div class="w-20 h-20 sm:w-32 sm:h-32 mx-auto mb-4 sm:mb-6">
          <div class="animate-spin rounded-full h-full w-full border-b-2 border-pink-400 mx-auto"></div>
        </div>
        <h3 class="text-lg sm:text-xl font-semibold text-gray-900 mb-2 sm:mb-3">Loading Products</h3>
        <p class="text-gray-500 text-sm sm:text-base">We're gathering the latest soccer gear for you...</p>
      </div>

      <!-- Error State -->
      <div id="errorState" class="hidden bg-white rounded-xl border border-gray-200 p-8 sm:p-12 text-center shadow-lg">
        <div class="w-20 h-20 sm:w-32 sm:h-32 mx-auto mb-4 sm:mb-6">
          <i class="fas fa-exclamation-triangle text-red-400 text-3xl sm:text-6xl"></i>
        </div>
        <h3 class="text-lg sm:text-xl font-semibold text-gray-900 mb-2 sm:mb-3">Failed to Load Products</h3>
        <p class="text-gray-500 mb-4 sm:mb-6 text-sm sm:text-base" id="errorMessage">There was an error loading the products.</p>
        <button onclick="loadProducts()" class="inline-flex items-center px-4 py-2 sm:px-6 sm:py-3 bg-pink-400 text-white rounded-lg hover:bg-pink-500 transition-all duration-200 shadow-lg text-sm sm:text-base">
          <i class="fas fa-redo mr-2"></i>
          Try Again
        </button>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="hidden bg-white rounded-xl border border-gray-200 p-8 sm:p-12 text-center shadow-lg">
        <div class="w-32 h-32 sm:w-48 sm:h-48 mx-auto mb-4 sm:mb-6">
          <div class="w-full h-full bg-gradient-to-br from-pink-50 to-pink-100 rounded-full flex items-center justify-center">
            <i class="fas fa-shopping-bag text-gray-400 text-4xl sm:text-6xl"></i>
          </div>
        </div>
        <h3 class="text-lg sm:text-xl font-semibold text-gray-900 mb-2 sm:mb-3">No Products Found</h3>
        <p class="text-gray-500 mb-4 sm:mb-6 text-sm sm:text-base">Be the first to showcase soccer products to our community.</p>
        <button onclick="showCreateModal()" class="inline-flex items-center px-4 py-2 sm:px-6 sm:py-3 bg-pink-400 text-white rounded-lg hover:bg-pink-500 transition-all duration-200 shadow-lg text-sm sm:text-base">
          <i class="fas fa-plus mr-2"></i>
          Create Product
        </button>
      </div>

      <!-- Product Grid -->
      <div id="productGrid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6">
        <!-- Product cards will be loaded here by JavaScript -->
      </div>
    </div>
  </div>
</div>

<!-- Mobile Floating Action Buttons -->
<div class="sm:hidden fixed bottom-6 right-6 z-40 flex flex-col gap-3 items-end">
  <!-- Scroll to Top Button -->
  <button onclick="scrollToTop()" class="w-12 h-12 bg-white text-pink-400 rounded-full shadow-lg border border-gray-200 flex items-center justify-center hover:bg-pink-50 transition-all duration-200 transform hover:scale-110 floating-btn">
    <i class="fas fa-arrow-up text-lg"></i>
  </button>
  
  <!-- Create Button -->
  <button onclick="showCreateModal()" class="w-14 h-14 bg-pink-400 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-pink-500 transition-all duration-200 transform hover:scale-110 floating-btn">
    <i class="fas fa-plus text-xl"></i>
  </button>
  
  <!-- Refresh Button -->
  <button onclick="loadProducts(); showToast('Refreshing...', 'info');" class="w-12 h-12 bg-white text-pink-400 rounded-full shadow-lg border border-gray-200 flex items-center justify-center hover:bg-pink-50 transition-all duration-200 transform hover:scale-110 floating-btn">
    <i class="fas fa-sync-alt text-lg"></i>
  </button>
</div>

<style>
/* Custom styles for better mobile experience */
.product-card {
  min-height: 280px;
}

/* Improved image container for mobile */
.product-image-container {
  position: relative;
  width: 100%;
  height: 0;
  padding-bottom: 75%; /* 4:3 aspect ratio */
  overflow: hidden;
  background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
}

.product-image-container img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: contain; /* Changed from cover to contain to show full image */
  object-position: center;
  transition: transform 0.3s ease;
}

.product-image-container .placeholder {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #9ca3af;
}

.product-card:hover .product-image-container img {
  transform: scale(1.05);
}

/* Better mobile text content */
.product-card .text-content {
  padding: 12px;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
}

/* Smooth scrolling */
html {
  scroll-behavior: smooth;
}

/* Better touch targets for mobile */
button, a {
  -webkit-tap-highlight-color: transparent;
}

/* Product card hover effects for desktop */
@media (min-width: 768px) {
  .product-card {
    transition: all 0.3s ease;
  }
  
  .product-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
  }
}

/* Desktop button improvements */
@media (min-width: 640px) {
  #refreshButton, button[onclick="showCreateModal()"] {
    transition: all 0.2s ease-in-out;
  }
  
  #refreshButton:hover, button[onclick="showCreateModal()"]:hover {
    transform: translateY(-1px);
  }
  
  /* Desktop image container */
  .product-image-container {
    padding-bottom: 66.67%; /* 3:2 aspect ratio for desktop */
  }
}

/* Mobile specific improvements */
@media (max-width: 640px) {
  .product-card {
    min-height: 260px;
  }
  
  .product-image-container {
    padding-bottom: 80%; /* Slightly taller aspect ratio for mobile */
  }
  
  .product-card .text-content {
    padding: 10px;
  }
  
  /* Ensure text doesn't overflow on mobile */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
}
</style>

<script src="{% static 'js/productManager.js' %}"></script>

<script>  
  window.currentUserId = "{{ user.id|default:'' }}";
// Function untuk scroll ke atas
function scrollToTop() {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

// Mobile-specific functionality
document.addEventListener('DOMContentLoaded', function() {
  // Add touch feedback for mobile buttons
  const buttons = document.querySelectorAll('button, a');
  buttons.forEach(button => {
    button.addEventListener('touchstart', function() {
      this.style.transform = 'scale(0.95)';
    });
    
    button.addEventListener('touchend', function() {
      this.style.transform = 'scale(1)';
    });
  });
  
  // Show/hide scroll to top button based on scroll position
  let scrollToTopBtn;
  window.addEventListener('scroll', function() {
    if (!scrollToTopBtn) {
      scrollToTopBtn = document.querySelector('[onclick="scrollToTop()"]');
    }
    
    if (scrollToTopBtn) {
      if (window.pageYOffset > 300) {
        scrollToTopBtn.style.opacity = '1';
        scrollToTopBtn.style.visibility = 'visible';
      } else {
        scrollToTopBtn.style.opacity = '0';
        scrollToTopBtn.style.visibility = 'hidden';
      }
    }
  });
});

// Simple Modal Functions untuk Edit dan Delete
function showEditModal(productId) {
    console.log('Edit product:', productId);
    document.getElementById('modalTitle').textContent = 'Edit Product';
    document.getElementById('submitButtonText').textContent = 'Update Product';
    document.getElementById('productId').value = productId;

    // Fetch product data via AJAX
    fetch(`/json/${productId}/`)
        .then(response => response.json())
        .then(data => {
            const product = data[0].fields;
            document.getElementById('name').value = product.name;
            document.getElementById('price').value = product.price;
            document.getElementById('brand').value = product.brand || '';
            document.getElementById('category').value = product.category;
            document.getElementById('rating').value = product.rating;
            document.getElementById('stock').value = product.stock;
            document.getElementById('thumbnail').value = product.thumbnail || '';
            document.getElementById('description').value = product.description || '';
            document.getElementById('is_featured').checked = product.is_featured;
        });

    // Show modal
    const modal = document.getElementById('productModal');
    modal.classList.remove('hidden');
    setTimeout(() => {
        modal.classList.add('modal-enter');
    }, 10);
}

function showDeleteModal(productId) {
    console.log('Delete product:', productId);
    
    if (confirm('Are you sure you want to delete this product?')) {
        deleteProduct(productId);
    }
}

// Simple delete function
function deleteProduct(productId) {
    console.log('Deleting product:', productId);
    
    fetch(`/delete-product/${productId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/x-www-form-urlencoded',
        },
    })
    .then(response => {
        if (response.ok) {
            showToast('Product deleted successfully!', 'success');
            // Refresh products
            loadProducts();
        } else {
            showToast('Failed to delete product', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('An error occurred while deleting product', 'error');
    });
}

// CSRF token helper
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Simple toast notification
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white ${
        type === 'success' ? 'bg-blue-400' : 
        type === 'error' ? 'bg-red-500' : 
        'bg-pink-500'
    } z-50`;
    toast.textContent = message;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// Create modal function (jika belum ada)
function showCreateModal() {
    window.location.href = '/create-product/';
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    // Load products
    loadProducts();
    
    // Initialize scroll to top button state
    const scrollToTopBtn = document.querySelector('[onclick="scrollToTop()"]');
    if (scrollToTopBtn) {
        scrollToTopBtn.style.opacity = '0';
        scrollToTopBtn.style.visibility = 'hidden';
        scrollToTopBtn.style.transition = 'all 0.3s ease';
    }
});
</script>

{% endblock content %}